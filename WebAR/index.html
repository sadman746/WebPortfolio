<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js AR Model Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/webxr/ARButton.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="loading-screen">
        <p class="instructions">
            Attendi il caricamento del modello 3D.
        </p>
        <button id="start-ar">Avvia AR</button>
    </div>
    
    <div id="three-container"></div>
    <button id="home-button" style="display: none;">Torna alla Home</button>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const startButton = document.getElementById("start-ar");
            const homeButton = document.getElementById("home-button");

            startButton.addEventListener("click", () => {
                document.getElementById("loading-screen").style.display = "none";
                homeButton.style.display = "block";
                initAR();
            });

            homeButton.addEventListener("click", () => {
                window.location.href = "/";
            });
        });

        function initAR() {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.getElementById("three-container").appendChild(renderer.domElement);

            document.body.appendChild(THREE.ARButton.createButton(renderer));

            const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
            scene.add(light);

            const loader = new THREE.GLTFLoader();
            loader.load('https://modelviewer.dev/shared-assets/models/Astronaut.glb', function (gltf) {
                const model = gltf.scene;
                model.position.set(0, 0, -1);
                model.scale.set(0.5, 0.5, 0.5);
                scene.add(model);
            }, undefined, function (error) {
                console.error('Errore nel caricamento del modello:', error);
            });

            function animate() {
                renderer.setAnimationLoop(() => {
                    renderer.render(scene, camera);
                });
            }
            animate();
        }
    </script>
</body>
</html>